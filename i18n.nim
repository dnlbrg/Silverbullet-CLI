
import std/tables, strutils

type
  Language* = enum
    langDE = "de"
    langEN = "en"

const translations* = {
  "de": {
    "config_saved": "Konfiguration gespeichert",
    "server": "Server",
    "token": "Token",
    "total": "Gesamt",
    "pages": "Seiten",
    "all": "alle",
    "without_system": "ohne System-Seiten, verwende --all um alle zu sehen",
    "showing": "Zeige",
    "of": "von",
    "found": "Gefunden",
    "backed_up": "Gesichert",
    "files": "Dateien",
    "skipped": "Übersprungen",
    "system_files": "System-Dateien (verwende --full für komplettes Backup)",
    "restored": "Wiederhergestellt",
    "size": "Größe",
    "bytes": "Bytes",
    "page_created": "Seite '$1' erstellt",
    "page_updated": "Seite '$1' aktualisiert",
    "page_deleted": "Seite '$1' gelöscht",
    "page_not_exist": "Seite '$1' existiert nicht, wird erstellt",
    "text_appended": "Text zu '$1' hinzugefügt",
    "invalid_pagename": "Ungültiger Seitenname",
    "backup_success": "Backup erfolgreich nach: $1",
    "restore_success": "Restore erfolgreich!",
    "downloaded": "Heruntergeladen",
    "uploaded": "Hochgeladen",
    "saved_as": "Gespeichert als",
    "as_page": "Als Seite",
    "file_not_found": "Datei nicht gefunden",
    "backup_dir_not_found": "Backup-Verzeichnis nicht gefunden",
    "download_error": "Fehler beim Download",
    "upload_error": "Fehler beim Upload",
    "aborted": "Abgebrochen.",
    "confirm_delete": "Seite '$1' wirklich löschen? (j/N): ",
    "pages_in_sb": "Seiten in SilverBullet",
    "search_for": "Suche nach",
    "in_title": "(im Titel)",
    "recent_pages": "Kürzlich geänderte Seiten",
    "creating_backup": "Erstelle Backup...",
    "target_dir": "Zielverzeichnis",
    "restoring_backup": "Stelle Backup wieder her...",
    "source": "Quelle",
    "target_prefix": "Ziel-Präfix",
    "target": "Ziel",
    "original_paths": "Original-Pfade",
    "downloading_page": "Lade Seite herunter...",
    "uploading_file": "Lade Datei hoch...",
    "analyzing_links": "Analysiere Verlinkungen...",
    "isolated_pages": "Isolierte Seiten (keine Verlinkungen)",
    "connections": "Verbindungen",
    "isolated": "Isoliert",
    "outgoing_links": "ausgehende Links",
    "incoming_links": "eingehende Links",
    "not_found": "(nicht vorhanden)",
    "could_not_restore": "Dateien konnten nicht wiederhergestellt werden",
    "error_no_url": "Keine Server-URL konfiguriert!",
    "error_use": "Verwende: sb config <server-url>",
    "error_example": "Beispiel:",
    "error_pagename_required": "Fehler: Seitenname erforderlich",
    "error_query_required": "Fehler: Suchbegriff erforderlich",
    "error_url_required": "Fehler: Server-URL erforderlich",
    "error_backup_dir_required": "Fehler: Backup-Verzeichnis erforderlich",
    "error_no_content": "Fehler: Kein Inhalt angegeben",
    "error_file_and_page_required": "Fehler: Quelldatei und Seitenname erforderlich",
    "error_unknown_command": "Unbekannter Befehl",
    "error_use_help": "Verwende 'sb help' für Hilfe",
    "usage_config": "Verwendung: sb config <url> [token]",
    "usage_create": "Verwendung: sb create <page> [<text>]",
    "usage_restore": "Verwendung: sb restore <backup-verzeichnis> [--to=<ziel-präfix>]",
    "usage_download": "Verwendung: sb download <page> [<ausgabedatei>]",
    "usage_upload": "Verwendung: sb upload <datei> <page>",
    "language_set": "Sprache gesetzt auf",
    "unknown_option": "Unbekannte Option: --$1",
    "fetching_page": "Rufe '$1' ab...",
    "page_exists_error": "Seite '$1' existiert bereits!",
    "use_edit_hint": "Verwende 'sb edit' zum Aktualisieren.",
    "page_does_not_exist_error": "Seite '$1' existiert nicht!",
    "use_create_hint": "Verwende 'sb create' zum Erstellen.",
    "new_draft_msg": "Seite existiert noch nicht. Neuer Entwurf.",
    "opening_editor": "Öffne $1...",
    "editor_error": "Editor mit Fehlercode $1 beendet",
    "no_changes": "Keine Änderungen vorgenommen.",
    "uploading_changes": "Lade Änderungen hoch...",
    "fetch_error_code": "Fehler beim Abrufen der Seite: $1",
    "ctrl_c_pressed": "Abbruch signalisiert... beende laufende Aufgaben.",
    "operation_aborted": "Vorgang durch Benutzer abgebrochen.",
    "retrying": "Fehler (Versuch $1/$2): $3"
  }.toTable,
  
  "en": {
    "config_saved": "Configuration saved",
    "server": "Server",
    "token": "Token",
    "total": "Total",
    "pages": "pages",
    "all": "all",
    "without_system": "without system pages, use --all to show all",
    "showing": "Showing",
    "of": "of",
    "found": "Found",
    "backed_up": "Backed up",
    "files": "files",
    "skipped": "Skipped",
    "system_files": "system files (use --full for complete backup)",
    "restored": "Restored",
    "size": "Size",
    "bytes": "bytes",
    "page_created": "Page '$1' created",
    "page_updated": "Page '$1' updated",
    "page_deleted": "Page '$1' deleted",
    "page_not_exist": "Page '$1' does not exist, creating",
    "text_appended": "Text appended to '$1'",
    "invalid_pagename": "Invalid page name",
    "backup_success": "Backup successful to: $1",
    "restore_success": "Restore successful!",
    "downloaded": "Downloaded",
    "uploaded": "Uploaded",
    "saved_as": "Saved as",
    "as_page": "As page",
    "file_not_found": "File not found",
    "backup_dir_not_found": "Backup directory not found",
    "download_error": "Download error",
    "upload_error": "Upload error",
    "aborted": "Aborted.",
    "confirm_delete": "Really delete page '$1'? (y/N): ",
    "pages_in_sb": "Pages in SilverBullet",
    "search_for": "Search for",
    "in_title": "(in title)",
    "recent_pages": "Recently changed pages",
    "creating_backup": "Creating backup...",
    "target_dir": "Target directory",
    "restoring_backup": "Restoring backup...",
    "source": "Source",
    "target_prefix": "Target prefix",
    "target": "Target",
    "original_paths": "Original paths",
    "downloading_page": "Downloading page...",
    "uploading_file": "Uploading file...",
    "analyzing_links": "Analyzing links...",
    "isolated_pages": "Isolated pages (no links)",
    "connections": "Connections",
    "isolated": "Isolated",
    "outgoing_links": "outgoing links",
    "incoming_links": "incoming links",
    "not_found": "(not found)",
    "could_not_restore": "files could not be restored",
    "error_no_url": "No server URL configured!",
    "error_use": "Use: sb config <server-url>",
    "error_example": "Example:",
    "error_pagename_required": "Error: Page name required",
    "error_query_required": "Error: Search query required",
    "error_url_required": "Error: Server URL required",
    "error_backup_dir_required": "Error: Backup directory required",
    "error_no_content": "Error: No content provided",
    "error_file_and_page_required": "Error: Source file and page name required",
    "error_unknown_command": "Unknown command",
    "error_use_help": "Use 'sb help' for help",
    "usage_config": "Usage: sb config <url> [token]",
    "usage_create": "Usage: sb create <page> [<text>]",
    "usage_restore": "Usage: sb restore <backup-directory> [--to=<target-prefix>]",
    "usage_download": "Usage: sb download <page> [<output-file>]",
    "usage_upload": "Usage: sb upload <file> <page>",
    "language_set": "Language set to",
    "unknown_option": "Unknown option: --$1",
    "fetching_page": "Fetching '$1'...",
    "page_exists_error": "Page '$1' already exists!",
    "use_edit_hint": "Use 'sb edit' to update it.",
    "page_does_not_exist_error": "Page '$1' does not exist!",
    "use_create_hint": "Use 'sb create' to create it.",
    "new_draft_msg": "Page does not exist yet. Creating new draft.",
    "opening_editor": "Opening $1...",
    "editor_error": "Editor exited with error code $1",
    "no_changes": "No changes made.",
    "uploading_changes": "Uploading changes...",
    "fetch_error_code": "Error fetching page: $1",
    "ctrl_c_pressed": "Abort signal received... finishing active tasks.",
    "operation_aborted": "Operation aborted by user.",
    "retrying": "Error (Try $1/$2): $3"
  }.toTable
}.toTable

proc t*(key: string, lang: string, args: varargs[string]): string =
  if lang in translations and key in translations[lang]:
    result = translations[lang][key]
    for i, arg in args:
      result = result.replace("$" & $(i+1), arg)
  else:
    result = key
